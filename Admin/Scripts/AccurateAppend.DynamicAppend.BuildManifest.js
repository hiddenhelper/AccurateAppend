var AccurateAppend;
(function (AccurateAppend) {
    var DyanmicAppend;
    (function (DyanmicAppend) {
        var BuildManifest;
        (function (BuildManifest) {
            var Manifest = AccurateAppend.DynamicAppend.Manifest;
            var OperationName = AccurateAppend.DynamicAppend.OperationName;
            var ViewModel = (function () {
                function ViewModel() {
                    this.manifest = new Manifest();
                }
                ViewModel.prototype.toggle = function (event) {
                    var self = this;
                    this.displayMessage(null);
                    var operationName = OperationName[$(event.target).prop("id")];
                    if ($(event.target).prop("checked"))
                        switch (operationName) {
                            case OperationName.DEDUPE_PHONE:
                            case OperationName.SET_PREF_PHONE:
                            case OperationName.SET_PREF_PHONE_SINGLE_COLUMN:
                                self.manifest.add($(event.target).prop("id"), function () {
                                    console.log("success");
                                    _.each(_.difference(_.pluck($("[name=phoneutil]"), "id"), [$(event.target).prop("id")]), function (id) {
                                        self.manifest.remove(id);
                                        $("#" + id).removeAttr("checked");
                                    });
                                }, function (e) {
                                    console.log("failure " + $(event.target).prop("id"));
                                    self.displayMessage(e.message);
                                    $("#" + $(event.target).prop("id")).removeAttr("checked");
                                });
                                break;
                            case OperationName.SET_PREF_ADDRESS_SINGLE_COLUMN:
                                self.manifest.add($(event.target).prop("id"), function () {
                                    console.log("success");
                                }, function (e) {
                                    console.log("failure " + $(event.target).prop("id"));
                                    self.displayMessage(e.message);
                                    $("#" + $(event.target).prop("id")).removeAttr("checked");
                                });
                                break;
                            case OperationName.SET_PREF_PHONE_COMPARE_INPUT:
                                self.manifest.add($(event.target).prop("id"), function () {
                                    console.log("success");
                                }, function (e) {
                                    console.log("failure " + $(event.target).prop("id"));
                                    self.displayMessage(e.message);
                                    $("#" + $(event.target).prop("id")).removeAttr("checked");
                                });
                                break;
                            case OperationName.SET_PREF_BASED_ON_VERIFICATION:
                                self.manifest.add($(event.target).prop("id"), function () {
                                    console.log("success");
                                }, function (e) {
                                    console.log("failure " + $(event.target).prop("id"));
                                    self.displayMessage(e.message);
                                    $("#" + $(event.target).prop("id")).removeAttr("checked");
                                });
                                break;
                            case OperationName.SET_PREF_EMAIL_VER:
                                self.manifest.add($(event.target).prop("id"), function () {
                                    console.log("success");
                                }, function (e) {
                                    console.log("failure " + $(event.target).prop("id"));
                                    self.displayMessage(e.message);
                                    $("#" + $(event.target).prop("id")).removeAttr("checked");
                                });
                                break;
                            default:
                                self.manifest.add($(event.target).prop("id"), null, function (e) {
                                    console.log("error adding operation " + $(event.target).prop("id"));
                                    self.displayMessage(e.message);
                                });
                                break;
                        }
                    else {
                        self.manifest.remove($(event.target).prop("id"));
                    }
                };
                ViewModel.prototype.submitUsingPredefinedManifest = function (event) {
                    var _this = this;
                    var url;
                    if ($(event.target).text() === "Download Manifest") {
                        url = "/Batch/DownloadManifest";
                    }
                    else {
                        url = "/Batch/DynamicAppend";
                    }
                    $.getJSON("/Batch/GetPredefinedManifest", { manifestName: $(event.target).prop("id") }).done(function (data) {
                        $("#form1").remove();
                        $("body").append($("<form action='" + url + "' method='POST' id='form1'>" +
                            "<input type='hidden' name='manifest' value='" + JSON.stringify(data) + "' />" +
                            "<input type='hidden' name='suppressionid' value='" + _this.manifest.supressionid() + "' />" +
                            "</form>"));
                        $("#form1").submit();
                    });
                };
                ViewModel.prototype.displayMessage = function (message) {
                    if (message)
                        $("#alert").removeAttr("class").addClass("alert alert-danger").text(message).show();
                    else
                        $("#alert").hide();
                };
                ViewModel.prototype.submit = function () {
                    var url = "/Batch/DynamicAppend";
                    $("#form1").remove();
                    $("body").append($("<form action='" + url + "' method='POST' id='form1'>" +
                        "<input type='hidden' name='manifest' value='" + this.manifest.toJson() + "' />" +
                        "<input type='hidden' name='suppressionid' value='" + this.manifest.supressionid() + "' />" +
                        "</form>"));
                    $("#form1").submit();
                };
                ViewModel.prototype.download = function () {
                    var url = "/Batch/DownloadManifest";
                    $("#form1").remove();
                    $("body").append($("<form action='" + url + "' method='POST' id='form1'>" +
                        "<input type='hidden' name='manifest' value='" + this.manifest.toJson() + "' />" +
                        "</form>"));
                    $("#form1").submit();
                };
                ViewModel.prototype.getButtonText = function () {
                    return $("#Category").val() === "DownloadManifest" ? "Download Manifest" : "Next";
                };
                ViewModel.prototype.nextClick = function () {
                    if ($("#Category").val() === "DownloadManifest")
                        buildManifestViewModel.download();
                    else
                        buildManifestViewModel.submit();
                };
                ViewModel.prototype.setSupressionId = function () {
                    $("#addSuppressionIdModelAlert").hide();
                    var suppressionid = $("#txtSupressionId").val().toLowerCase();
                    var regex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
                    if (regex.exec(suppressionid) != null) {
                        console.log("suppression appears to be valid");
                        this.manifest.supressionid(suppressionid);
                        $("#addSuppressionIdModel").modal("hide");
                        return true;
                    }
                    else {
                        console.log("suppression appears to be invalid");
                        $("#addSuppressionIdModelAlert").text("The value you entered does not appear to a GUID.").show();
                    }
                };
                ViewModel.prototype.openSupressionModal = function () {
                    $("#addSuppressionIdModel").modal("show");
                };
                return ViewModel;
            }());
            BuildManifest.ViewModel = ViewModel;
        })(BuildManifest = DyanmicAppend.BuildManifest || (DyanmicAppend.BuildManifest = {}));
    })(DyanmicAppend = AccurateAppend.DyanmicAppend || (AccurateAppend.DyanmicAppend = {}));
})(AccurateAppend || (AccurateAppend = {}));
var buildManifestViewModel;
$(function () {
    buildManifestViewModel = new AccurateAppend.DyanmicAppend.BuildManifest.ViewModel();
    ko.applyBindings(buildManifestViewModel);
    $("#phoneAppendAccordion").collapse();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQWNjdXJhdGVBcHBlbmQuRHluYW1pY0FwcGVuZC5CdWlsZE1hbmlmZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQWNjdXJhdGVBcHBlbmQuRHluYW1pY0FwcGVuZC5CdWlsZE1hbmlmZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUtBLElBQU8sY0FBYyxDQWdNcEI7QUFoTUQsV0FBTyxjQUFjO0lBQUMsSUFBQSxhQUFhLENBZ01sQztJQWhNcUIsV0FBQSxhQUFhO1FBQUMsSUFBQSxhQUFhLENBZ01oRDtRQWhNbUMsV0FBQSxhQUFhO1lBRTdDLElBQU8sUUFBUSxHQUFHLGVBQUEsYUFBYSxDQUFDLFFBQVEsQ0FBQztZQUN6QyxJQUFPLGFBQWEsR0FBRyxlQUFBLGFBQWEsQ0FBQyxhQUFhLENBQUM7WUFFbkQ7Z0JBS0k7b0JBQ0ksSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLFFBQVEsRUFBRSxDQUFDO2dCQUNuQyxDQUFDO2dCQUdELDBCQUFNLEdBQU4sVUFBTyxLQUF3QjtvQkFDM0IsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO29CQUNoQixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO29CQUMxQixJQUFJLGFBQWEsR0FBa0IsYUFBYSxDQUFTLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7b0JBR3JGLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO3dCQUUvQixRQUFRLGFBQWEsRUFBRTs0QkFDbkIsS0FBSyxhQUFhLENBQUMsWUFBWSxDQUFDOzRCQUNoQyxLQUFLLGFBQWEsQ0FBQyxjQUFjLENBQUM7NEJBQ2xDLEtBQUssYUFBYSxDQUFDLDRCQUE0QjtnQ0FDM0MsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJ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WUFBWSxDQUFDLGFBQWEsQ0FBQyxDQUFDO3dCQUMxQyxDQUFDLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7d0JBQzFDLE9BQU8sSUFBSSxDQUFDO3FCQUNmO3lCQUFNO3dCQUNILE9BQU8sQ0FBQyxHQUFHLENBQUMsbUNBQW1DLENBQUMsQ0FBQzt3QkFDakQsQ0FBQyxDQUFDLDZCQUE2QixDQUFDLENBQUMsSUFBSSxDQUFDLGtEQUFrRCxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7cUJBQ3BHO2dCQUNMLENBQUM7Z0JBRUQsdUNBQW1CLEdBQW5CO29CQUNJLENBQUMsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDOUMsQ0FBQztnQkFDTCxnQkFBQztZQUFELENBQUMsQUF6TEQsSUF5TEM7WUF6TFksdUJBQVMsWUF5THJCLENBQUE7UUFFTCxDQUFDLEVBaE1tQyxhQUFhLEdBQWIsMkJBQWEsS0FBYiwyQkFBYSxRQWdNaEQ7SUFBRCxDQUFDLEVBaE1xQixhQUFhLEdBQWIsNEJBQWEsS0FBYiw0QkFBYSxRQWdNbEM7QUFBRCxDQUFDLEVBaE1NLGNBQWMsS0FBZCxjQUFjLFFBZ01wQjtBQUdELElBQUksc0JBQTRFLENBQUM7QUFFakYsQ0FBQyxDQUFDO0lBRUUsc0JBQXNCLEdBQUcsSUFBSSxjQUFjLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUNwRixFQUFFLENBQUMsYUFBYSxDQUFDLHNCQUFzQixDQUFDLENBQUM7SUFFekMsQ0FBQyxDQUFDLHVCQUF1QixDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7QUFFMUMsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwidHlwaW5ncy9rbm9ja291dC9rbm9ja291dC5kLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cInR5cGluZ3MvanF1ZXJ5L2pxdWVyeS5kLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cInR5cGluZ3MvdW5kZXJzY29yZS91bmRlcnNjb3JlLmQudHNcIiAvPlxyXG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwidHlwaW5ncy9ib290c3RyYXAvYm9vdHN0cmFwLmQudHNcIiAvPlxyXG5cclxubW9kdWxlIEFjY3VyYXRlQXBwZW5kLkR5YW5taWNBcHBlbmQuQnVpbGRNYW5pZmVzdCB7XHJcblxyXG4gICAgaW1wb3J0IE1hbmlmZXN0ID0gRHluYW1pY0FwcGVuZC5NYW5pZmVzdDtcclxuICAgIGltcG9ydCBPcGVyYXRpb25OYW1lID0gRHluYW1pY0FwcGVuZC5PcGVyYXRpb25OYW1lO1xyXG5cclxuICAgIGV4cG9ydCBjbGFzcyBWaWV3TW9kZWwge1xyXG5cclxuICAgICAgICBtYW5pZmVzdDogTWFuaWZlc3Q7XHJcbiAgICAgICAgY2F0ZWdvcnk6IHN0cmluZztcclxuXHJcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgICAgIHRoaXMubWFuaWZlc3QgPSBuZXcgTWFuaWZlc3QoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFRvZ2dsZXMgaW5jbHVzaW9uIG9mIE9wZXJhdGlvbiBiYXNlZCBvbiBzdGF0ZSBvZiBjaGVja2JveCBpbiBVSVxyXG4gICAgICAgIHRvZ2dsZShldmVudDogSlF1ZXJ5RXZlbnRPYmplY3QpIHtcclxuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlNZXNzYWdlKG51bGwpO1xyXG4gICAgICAgICAgICB2YXIgb3BlcmF0aW9uTmFtZSA9IDxPcGVyYXRpb25OYW1lPk9wZXJhdGlvbk5hbWVbPHN0cmluZz4kKGV2ZW50LnRhcmdldCkucHJvcChcImlkXCIpXTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIGFkZCBPcGVyYXRpb25cclxuICAgICAgICAgICAgaWYgKCQoZXZlbnQudGFyZ2V0KS5wcm9wKFwiY2hlY2tlZFwiKSlcclxuICAgICAgICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZXMgd2hlcmUgb3RoZXIgT3BlcmF0aW9ucyBhcmUgYWZmZWN0ZWQgYnkgdGhlIG9wZXJhdGlvbiBiZWluZyBhZGRlZC4gTWF5IG5lZWQgdG8gdW4tY2hlY2sgb3V0cHV0IGZpZWxkc1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChvcGVyYXRpb25OYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBPcGVyYXRpb25OYW1lLkRFRFVQRV9QSE9ORTpcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIE9wZXJhdGlvbk5hbWUuU0VUX1BSRUZfUEhPTkU6XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBPcGVyYXRpb25OYW1lLlNFVF9QUkVGX1BIT05FX1NJTkdMRV9DT0xVTU46XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubWFuaWZlc3QuYWRkKCQoZXZlbnQudGFyZ2V0KS5wcm9wKFwiaWRcIiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdWNjZXNzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJzdWNjZXNzXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVuY2hlY2sgcGhvbmUgdXRpbCBjaGVja2JveGVzIGV4Y2VwdCB0aGUgb25lIHRoYXQgdHJpZ2dlcmVkIHRoZSBldmVudFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZWFjaChfLmRpZmZlcmVuY2UoXy5wbHVjaygkKFwiW25hbWU9cGhvbmV1dGlsXVwiKSwgXCJpZFwiKSwgWyQoZXZlbnQudGFyZ2V0KS5wcm9wKFwiaWRcIildKSwgKGlkKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubWFuaWZlc3QucmVtb3ZlKGlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNcIiArIGlkKS5yZW1vdmVBdHRyKFwiY2hlY2tlZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlcnJvclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJmYWlsdXJlIFwiICsgPHN0cmluZz4kKGV2ZW50LnRhcmdldCkucHJvcChcImlkXCIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRpc3BsYXlNZXNzYWdlKGUubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNcIiArICQoZXZlbnQudGFyZ2V0KS5wcm9wKFwiaWRcIikpLnJlbW92ZUF0dHIoXCJjaGVja2VkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgT3BlcmF0aW9uTmFtZS5TRVRfUFJFRl9BRERSRVNTX1NJTkdMRV9DT0xVTU46XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubWFuaWZlc3QuYWRkKCQoZXZlbnQudGFyZ2V0KS5wcm9wKFwiaWRcIiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdWNjZXNzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJzdWNjZXNzXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVycm9yXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImZhaWx1cmUgXCIgKyA8c3RyaW5nPiQoZXZlbnQudGFyZ2V0KS5wcm9wKFwiaWRcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGlzcGxheU1lc3NhZ2UoZS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiI1wiICsgJChldmVudC50YXJnZXQpLnByb3AoXCJpZFwiKSkucmVtb3ZlQXR0cihcImNoZWNrZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBPcGVyYXRpb25OYW1lLlNFVF9QUkVGX1BIT05FX0NPTVBBUkVfSU5QVVQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubWFuaWZlc3QuYWRkKCQoZXZlbnQudGFyZ2V0KS5wcm9wKFwiaWRcIiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdWNjZXNzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJzdWNjZXNzXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVycm9yXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImZhaWx1cmUgXCIgKyA8c3RyaW5nPiQoZXZlbnQudGFyZ2V0KS5wcm9wKFwiaWRcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGlzcGxheU1lc3NhZ2UoZS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiI1wiICsgJChldmVudC50YXJnZXQpLnByb3AoXCJpZFwiKSkucmVtb3ZlQXR0cihcImNoZWNrZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBPcGVyYXRpb25OYW1lLlNFVF9QUkVGX0JBU0VEX09OX1ZFUklGSUNBVElPTjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5tYW5pZmVzdC5hZGQoJChldmVudC50YXJnZXQpLnByb3AoXCJpZFwiKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN1Y2Nlc3NcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInN1Y2Nlc3NcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXJyb3JcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZmFpbHVyZSBcIiArIDxzdHJpbmc+JChldmVudC50YXJnZXQpLnByb3AoXCJpZFwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kaXNwbGF5TWVzc2FnZShlLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjXCIgKyAkKGV2ZW50LnRhcmdldCkucHJvcChcImlkXCIpKS5yZW1vdmVBdHRyKFwiY2hlY2tlZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIE9wZXJhdGlvbk5hbWUuU0VUX1BSRUZfRU1BSUxfVkVSOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm1hbmlmZXN0LmFkZCgkKGV2ZW50LnRhcmdldCkucHJvcChcImlkXCIpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3VjY2Vzc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic3VjY2Vzc1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlcnJvclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJmYWlsdXJlIFwiICsgPHN0cmluZz4kKGV2ZW50LnRhcmdldCkucHJvcChcImlkXCIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRpc3BsYXlNZXNzYWdlKGUubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNcIiArICQoZXZlbnQudGFyZ2V0KS5wcm9wKFwiaWRcIikpLnJlbW92ZUF0dHIoXCJjaGVja2VkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubWFuaWZlc3QuYWRkKCQoZXZlbnQudGFyZ2V0KS5wcm9wKFwiaWRcIiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN1Y2Nlc3MgY2FsbGJhY2tcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlcnJvciBjYWxsYmFja1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvciBhZGRpbmcgb3BlcmF0aW9uIFwiICsgJChldmVudC50YXJnZXQpLnByb3AoXCJpZFwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kaXNwbGF5TWVzc2FnZShlLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyByZW1vdmUgT3BlcmF0aW9uXHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2VsZi5tYW5pZmVzdC5yZW1vdmUoJChldmVudC50YXJnZXQpLnByb3AoXCJpZFwiKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHN1Ym1pdHMgdXNpbmcgcHJlLWRlZmluZWQgbWFuaWZlc3RcclxuICAgICAgICBzdWJtaXRVc2luZ1ByZWRlZmluZWRNYW5pZmVzdChldmVudDogSlF1ZXJ5RXZlbnRPYmplY3QpIHtcclxuICAgICAgICAgICAgdmFyIHVybDtcclxuICAgICAgICAgICAgaWYgKDxzdHJpbmc+JChldmVudC50YXJnZXQpLnRleHQoKSA9PT0gXCJEb3dubG9hZCBNYW5pZmVzdFwiKSB7XHJcbiAgICAgICAgICAgICAgICB1cmwgPSBcIi9CYXRjaC9Eb3dubG9hZE1hbmlmZXN0XCI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB1cmwgPSBcIi9CYXRjaC9EeW5hbWljQXBwZW5kXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJC5nZXRKU09OKFwiL0JhdGNoL0dldFByZWRlZmluZWRNYW5pZmVzdFwiLCB7IG1hbmlmZXN0TmFtZTogPHN0cmluZz4kKGV2ZW50LnRhcmdldCkucHJvcChcImlkXCIpIH0pLmRvbmUoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBzdWJtaXQgZm9ybVxyXG4gICAgICAgICAgICAgICAgJChcIiNmb3JtMVwiKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgICQoXCJib2R5XCIpLmFwcGVuZCgkKFwiPGZvcm0gYWN0aW9uPSdcIiArIHVybCArIFwiJyBtZXRob2Q9J1BPU1QnIGlkPSdmb3JtMSc+XCIgK1xyXG4gICAgICAgICAgICAgICAgICAgIFwiPGlucHV0IHR5cGU9J2hpZGRlbicgbmFtZT0nbWFuaWZlc3QnIHZhbHVlPSdcIiArIEpTT04uc3RyaW5naWZ5KGRhdGEpICsgXCInIC8+XCIgK1xyXG4gICAgICAgICAgICAgICAgICAgIFwiPGlucHV0IHR5cGU9J2hpZGRlbicgbmFtZT0nc3VwcHJlc3Npb25pZCcgdmFsdWU9J1wiICsgdGhpcy5tYW5pZmVzdC5zdXByZXNzaW9uaWQoKSArIFwiJyAvPlwiICtcclxuICAgICAgICAgICAgICAgICAgICBcIjwvZm9ybT5cIikpO1xyXG4gICAgICAgICAgICAgICAgJChcIiNmb3JtMVwiKS5zdWJtaXQoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBkaXNwbGF5cyBlcnJvciBtZXNzYWdlXHJcbiAgICAgICAgZGlzcGxheU1lc3NhZ2UobWVzc2FnZTogc3RyaW5nKSB7XHJcbiAgICAgICAgICAgIGlmIChtZXNzYWdlKVxyXG4gICAgICAgICAgICAgICAgJChcIiNhbGVydFwiKS5yZW1vdmVBdHRyKFwiY2xhc3NcIikuYWRkQ2xhc3MoXCJhbGVydCBhbGVydC1kYW5nZXJcIikudGV4dChtZXNzYWdlKS5zaG93KCk7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICQoXCIjYWxlcnRcIikuaGlkZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gc3VibWl0IHRvIENvbnRyb2xsZXJcclxuICAgICAgICBzdWJtaXQoKSB7XHJcbiAgICAgICAgICAgIHZhciB1cmwgPSBcIi9CYXRjaC9EeW5hbWljQXBwZW5kXCI7XHJcbiAgICAgICAgICAgICQoXCIjZm9ybTFcIikucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICQoXCJib2R5XCIpLmFwcGVuZCgkKFwiPGZvcm0gYWN0aW9uPSdcIiArIHVybCArIFwiJyBtZXRob2Q9J1BPU1QnIGlkPSdmb3JtMSc+XCIgK1xyXG4gICAgICAgICAgICAgICAgXCI8aW5wdXQgdHlwZT0naGlkZGVuJyBuYW1lPSdtYW5pZmVzdCcgdmFsdWU9J1wiICsgdGhpcy5tYW5pZmVzdC50b0pzb24oKSArIFwiJyAvPlwiICtcclxuICAgICAgICAgICAgICAgIFwiPGlucHV0IHR5cGU9J2hpZGRlbicgbmFtZT0nc3VwcHJlc3Npb25pZCcgdmFsdWU9J1wiICsgdGhpcy5tYW5pZmVzdC5zdXByZXNzaW9uaWQoKSArIFwiJyAvPlwiICtcclxuICAgICAgICAgICAgICAgIFwiPC9mb3JtPlwiKSk7XHJcbiAgICAgICAgICAgICQoXCIjZm9ybTFcIikuc3VibWl0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkb3dubG9hZCgpIHtcclxuICAgICAgICAgICAgdmFyIHVybCA9IFwiL0JhdGNoL0Rvd25sb2FkTWFuaWZlc3RcIjtcclxuICAgICAgICAgICAgJChcIiNmb3JtMVwiKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgJChcImJvZHlcIikuYXBwZW5kKCQoXCI8Zm9ybSBhY3Rpb249J1wiICsgdXJsICsgXCInIG1ldGhvZD0nUE9TVCcgaWQ9J2Zvcm0xJz5cIiArXHJcbiAgICAgICAgICAgICAgICBcIjxpbnB1dCB0eXBlPSdoaWRkZW4nIG5hbWU9J21hbmlmZXN0JyB2YWx1ZT0nXCIgKyB0aGlzLm1hbmlmZXN0LnRvSnNvbigpICsgXCInIC8+XCIgK1xyXG4gICAgICAgICAgICAgICAgXCI8L2Zvcm0+XCIpKTtcclxuICAgICAgICAgICAgJChcIiNmb3JtMVwiKS5zdWJtaXQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGdldEJ1dHRvblRleHQoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkKFwiI0NhdGVnb3J5XCIpLnZhbCgpID09PSBcIkRvd25sb2FkTWFuaWZlc3RcIiA/IFwiRG93bmxvYWQgTWFuaWZlc3RcIiA6IFwiTmV4dFwiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbmV4dENsaWNrKCkge1xyXG4gICAgICAgICAgICBpZiAoJChcIiNDYXRlZ29yeVwiKS52YWwoKSA9PT0gXCJEb3dubG9hZE1hbmlmZXN0XCIpXHJcbiAgICAgICAgICAgICAgICBidWlsZE1hbmlmZXN0Vmlld01vZGVsLmRvd25sb2FkKCk7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGJ1aWxkTWFuaWZlc3RWaWV3TW9kZWwuc3VibWl0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZXRTdXByZXNzaW9uSWQoKSB7XHJcbiAgICAgICAgICAgIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNzkwNTkyOS9ob3ctdG8tdGVzdC12YWxpZC11dWlkLWd1aWRcclxuICAgICAgICAgICAgJChcIiNhZGRTdXBwcmVzc2lvbklkTW9kZWxBbGVydFwiKS5oaWRlKCk7XHJcbiAgICAgICAgICAgIHZhciBzdXBwcmVzc2lvbmlkID0gJChcIiN0eHRTdXByZXNzaW9uSWRcIikudmFsKCkudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgdmFyIHJlZ2V4ID0gL15bMC05YS1mXXs4fS1bMC05YS1mXXs0fS1bMS01XVswLTlhLWZdezN9LVs4OWFiXVswLTlhLWZdezN9LVswLTlhLWZdezEyfSQvaTtcclxuICAgICAgICAgICAgaWYgKHJlZ2V4LmV4ZWMoc3VwcHJlc3Npb25pZCkgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJzdXBwcmVzc2lvbiBhcHBlYXJzIHRvIGJlIHZhbGlkXCIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tYW5pZmVzdC5zdXByZXNzaW9uaWQoc3VwcHJlc3Npb25pZCk7XHJcbiAgICAgICAgICAgICAgICAkKFwiI2FkZFN1cHByZXNzaW9uSWRNb2RlbFwiKS5tb2RhbChcImhpZGVcIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic3VwcHJlc3Npb24gYXBwZWFycyB0byBiZSBpbnZhbGlkXCIpO1xyXG4gICAgICAgICAgICAgICAgJChcIiNhZGRTdXBwcmVzc2lvbklkTW9kZWxBbGVydFwiKS50ZXh0KFwiVGhlIHZhbHVlIHlvdSBlbnRlcmVkIGRvZXMgbm90IGFwcGVhciB0byBhIEdVSUQuXCIpLnNob3coKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb3BlblN1cHJlc3Npb25Nb2RhbCgpIHtcclxuICAgICAgICAgICAgJChcIiNhZGRTdXBwcmVzc2lvbklkTW9kZWxcIikubW9kYWwoXCJzaG93XCIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn1cclxuXHJcbi8vdmFyIG1hbmlmZXN0OiBBY2N1cmF0ZUFwcGVuZC5EeW5hbWljQXBwZW5kLk1hbmlmZXN0O1xyXG52YXIgYnVpbGRNYW5pZmVzdFZpZXdNb2RlbDogQWNjdXJhdGVBcHBlbmQuRHlhbm1pY0FwcGVuZC5CdWlsZE1hbmlmZXN0LlZpZXdNb2RlbDtcclxuXHJcbiQoKCkgPT4ge1xyXG5cclxuICAgIGJ1aWxkTWFuaWZlc3RWaWV3TW9kZWwgPSBuZXcgQWNjdXJhdGVBcHBlbmQuRHlhbm1pY0FwcGVuZC5CdWlsZE1hbmlmZXN0LlZpZXdNb2RlbCgpO1xyXG4gICAga28uYXBwbHlCaW5kaW5ncyhidWlsZE1hbmlmZXN0Vmlld01vZGVsKTtcclxuXHJcbiAgICAkKFwiI3Bob25lQXBwZW5kQWNjb3JkaW9uXCIpLmNvbGxhcHNlKCk7XHJcblxyXG59KTtcclxuXHJcbiJdfQ==